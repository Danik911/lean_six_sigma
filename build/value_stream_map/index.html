<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SimplePharma Value Stream Map</title>
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    
    /* Debug styles */
    .debug-info {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px;
      border-radius: 5px;
      z-index: 9999;
      font-size: 12px;
    }
    
    /* Process node styles */
    .process-node {
      position: absolute;
      width: 160px;
      border-radius: 4px;
      padding: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
      transform: translate(-50%, -50%);
      cursor: pointer;
      transition: box-shadow 0.2s ease, transform 0.3s ease;
    }
    
    .process-node:hover {
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .process-node.highlighted {
      transform: translate(-50%, -50%) scale(1.05);
      box-shadow: 0 0 0 3px #FCD34D, 0 4px 8px rgba(0,0,0,0.2);
      z-index: 20;
    }
    
    .inventory-node {
      position: absolute;
      width: 60px;
      height: 60px;
      transform: translate(-50%, -50%) rotate(45deg);
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
      cursor: pointer;
      transition: box-shadow 0.2s ease, transform 0.3s ease;
    }
    
    .inventory-node.highlighted {
      transform: translate(-50%, -50%) rotate(45deg) scale(1.05);
      box-shadow: 0 0 0 3px #FCD34D, 0 4px 8px rgba(0,0,0,0.2);
      z-index: 20;
    }
    
    .inventory-node-content {
      transform: rotate(-45deg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
    }
    
    /* Waste icon styles */
    .waste-icon {
      position: absolute;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: help;
      font-size: 14px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
      z-index: 5;
    }
    
    .waste-tooltip {
      display: none;
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%); /* Keep this for centering */
      transform-origin: center bottom; /* Set origin for potential rotation */
      margin-bottom: 8px;
      padding: 6px 10px;
      background-color: rgba(0,0,0,0.8);
      color: white;
      border-radius: 4px;
      font-size: 12px;
      white-space: nowrap;
      z-index: 10;
      pointer-events: none;
    }
    
    /* Add rule for counter-rotating tooltips on rotated parents */
    .waste-tooltip.tooltip-needs-unrotate {
        transform: translateX(-50%) rotate(-45deg);
    }

    .waste-icon:hover .waste-tooltip {
      display: block;
    }

    /* Connection path styles */
    .connection-path {
      stroke: #94a3b8;
      stroke-width: 2;
      fill: none;
      stroke-dasharray: 5, 5;
      opacity: 0.7;
    }

    .connection-path.highlighted {
      stroke: #f59e0b;
      stroke-width: 3;
      stroke-dasharray: none;
    }
    
    /* Modal styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }
    
    .modal-content {
      background-color: white;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 42rem;
      margin: 0 1rem;
      max-height: 90vh;
      overflow-y: auto;
    }

    .process-tooltip {
      position: fixed;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 14px;
      z-index: 100;
      pointer-events: none;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      max-width: 220px;
      white-space: normal;
      text-align: center;
    }

    .drill-down-button {
      position: absolute;
      bottom: -30px;
      left: 50%;
      transform: translateX(-50%);
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 12px;
      cursor: pointer;
      display: none;
      white-space: nowrap;
      z-index: 15;
    }

    .process-node:hover .drill-down-button,
    .process-node.highlighted .drill-down-button {
      display: block;
    }
  </style>
</head>
<body>
  <!-- Debug container to show load status -->
  <div id="debug-container" class="debug-info">Loading React app...</div>
  
  <div id="root"></div>
  
  <!-- Load the App component -->
  <script type="text/babel">
    // Define waste icons and descriptions
    const wasteIcons = {
      motion: { icon: '🔄', name: 'Motion Waste', color: 'bg-purple-200 border-purple-500' },
      waiting: { icon: '⏳', name: 'Waiting Waste', color: 'bg-blue-200 border-blue-500' },
      transportation: { icon: '🚚', name: 'Transportation Waste', color: 'bg-green-200 border-green-500' },
      defects: { icon: '❌', name: 'Defects Waste', color: 'bg-red-200 border-red-500' },
      overprocessing: { icon: '⚙️', name: 'Overprocessing Waste', color: 'bg-yellow-200 border-yellow-500' },
      inventory: { icon: '📦', name: 'Inventory Waste', color: 'bg-orange-200 border-orange-500' },
      talent: { icon: '👤', name: 'Talent Waste', color: 'bg-indigo-200 border-indigo-500' }
    };
    
    // Basic simplified ValueStreamMap component
    const ValueStreamMap = () => {
      // Basic state
      const [viewMode, setViewMode] = React.useState('current'); // current, improved, ideal
      const [selectedProcess, setSelectedProcess] = React.useState(null);
      const [showInfoModal, setShowInfoModal] = React.useState(false);
      const [metrics, setMetrics] = React.useState({
        totalLeadTime: 85.7,
        valueAddedTime: 12.4,
        processCycleEfficiency: 14.5,
        accuracyRate: 76.5
      });
      const [highlightedProcess, setHighlightedProcess] = React.useState(null);
      const [tooltip, setTooltip] = React.useState({ show: false, text: '', x: 0, y: 0 });
      
      // Waste data based on lean waste analysis
      const wasteData = {
        'process-receiving': {
          wastes: [
            { type: 'motion', data: 'Unnecessary movement during receiving' },
            { type: 'waiting', data: 'Waiting for inspection approvals' }
          ]
        },
        'process-storage': {
          wastes: [
            { type: 'inventory', data: 'Long storage (72hrs avg)' },
            { type: 'transportation', data: 'Moving between building areas' }
          ]
        },
        'process-distribution': {
          wastes: [
            { type: 'transportation', data: 'Moving between shop floor & warehouses' },
            { type: 'motion', data: 'Unnecessary movement between floors' }
          ]
        },
        'process-shopfloor': {
          wastes: [
            { type: 'inventory', data: 'Excess inventory on shelves' },
            { type: 'talent', data: 'Staff skills misalignment' }
          ]
        },
        'process-stocktake': {
          wastes: [
            { type: 'defects', data: '23.5% error rate, 10.19% avg magnitude' },
            { type: 'waiting', data: '1hr lunch breaks, waiting for scanners' },
            { type: 'overprocessing', data: 'Double counting, sticky notes' },
            { type: 'motion', data: 'Movement during counting process' },
            { type: 'talent', data: 'Underutilization of advanced-trained staff' }
          ]
        },
        'inventory-receiving': {
          wastes: [
            { type: 'inventory', data: 'WIP waiting time: 3 hours' }
          ],
          showLabel: true
        },
        'inventory-storage': {
          wastes: [
            { type: 'inventory', data: 'Storage waiting time: 72 hours' }
          ],
          showLabel: true
        },
        'inventory-transit': {
          wastes: [
            { type: 'transportation', data: 'Moving between shop floor & warehouses' }
          ],
          showLabel: true
        }
      };
      
      // Process data based on vfm.txt with increased spacing and added third supplier (VitaFast)
      const processes = [
        // Suppliers
        {
          id: 'supplier-meddev',
          name: 'MedDev',
          type: 'supplier',
          metrics: {
            deliveryFrequency: 'Daily',
            leadTime: '1-2 days'
          },
          details: 'Medical device supplier',
          position: { x: 8, y: 25 }
        },
        {
          id: 'supplier-drugseek',
          name: 'DrugSeek',
          type: 'supplier',
          metrics: {
            deliveryFrequency: '3 times/week',
            leadTime: '1 day'
          },
          details: 'Pharmaceutical supplier',
          position: { x: 8, y: 50 }
        },
        {
          id: 'supplier-vitafast',
          name: 'VitaFast',
          type: 'supplier',
          metrics: {
            deliveryFrequency: '2 times/week',
            leadTime: '2-3 days'
          },
          details: 'Miscellaneous goods supplier',
          position: { x: 8, y: 75 }
        },
        
        // Processes - increased x-axis spacing
        {
          id: 'process-receiving',
          name: 'Receiving',
          type: 'process',
          metrics: {
            oeeUtilization: 92,
            accuracy: 94,
            processTime: 3.5
          },
          details: 'Trucks arrive at inward goods zone between buildings',
          position: { x: 25, y: 35 }
        },
        {
          id: 'process-storage',
          name: 'Storage',
          type: 'process',
          metrics: {
            oeeUtilization: 88,
            accuracy: 76.5,
            processTime: 0.7,
            waitTime: 72
          },
          details: 'Medical devices stored in main warehouse (3rd floor)',
          position: { x: 42, y: 35 }
        },
        {
          id: 'process-distribution',
          name: 'Distribution',
          type: 'process',
          metrics: {
            oeeUtilization: 85,
            accuracy: 82,
            processTime: 1.1
          },
          details: 'Staff transfers products between warehouses and shop',
          position: { x: 59, y: 35 }
        },
        {
          id: 'process-shopfloor',
          name: 'Shop Floor',
          type: 'process',
          metrics: {
            oeeUtilization: 82,
            accuracy: 93,
            processTime: 0.1
          },
          details: 'Products are arranged on shelves and sold to customers',
          position: { x: 76, y: 35 }
        },
        {
          id: 'process-stocktake',
          name: 'Stock Take',
          type: 'process',
          metrics: {
            oeeUtilization: 65,
            accuracy: 76.5,
            processTime: 6
          },
          details: 'Quarterly stock count process',
          position: { x: 76, y: 65 },
          hasDrillDown: true,
          drillDownUrl: '../process_flow_diagram/stocktake_process.html'
        },
        
        // Customer
        {
          id: 'customer',
          name: 'Customers',
          type: 'customer',
          metrics: {
            satisfaction: 82
          },
          details: 'End customers purchasing products',
          position: { x: 92, y: 35 }
        },
        
        // Inventory nodes - also adjusted spacing
        {
          id: 'inventory-receiving',
          name: 'WIP',
          type: 'inventory',
          metrics: {
            waitTime: 3
          },
          details: 'Work in progress after receiving',
          position: { x: 33.5, y: 35 }
        },
        {
          id: 'inventory-storage',
          name: 'Storage',
          type: 'inventory',
          metrics: {
            waitTime: 72
          },
          details: 'Stored inventory',
          position: { x: 50.5, y: 35 }
        },
        {
          id: 'inventory-transit',
          name: 'Transit',
          type: 'inventory',
          metrics: {
            waitTime: 5
          },
          details: 'In-transit inventory',
          position: { x: 67.5, y: 35 }
        }
      ];

      // Process connections for material flow
      const connections = [
        // Supplier to receiving connections
        { from: 'supplier-meddev', to: 'process-receiving' },
        { from: 'supplier-drugseek', to: 'process-receiving' },
        { from: 'supplier-vitafast', to: 'process-receiving' },
        
        // Main flow
        { from: 'process-receiving', to: 'inventory-receiving' },
        { from: 'inventory-receiving', to: 'process-storage' },
        { from: 'process-storage', to: 'inventory-storage' },
        { from: 'inventory-storage', to: 'process-distribution' },
        { from: 'process-distribution', to: 'inventory-transit' },
        { from: 'inventory-transit', to: 'process-shopfloor' },
        { from: 'process-shopfloor', to: 'customer' },
        
        // Stocktake connections
        { from: 'process-storage', to: 'process-stocktake' },
        { from: 'process-shopfloor', to: 'process-stocktake' },
        { from: 'process-stocktake', to: 'process-storage', type: 'feedback' },
        { from: 'process-stocktake', to: 'process-shopfloor', type: 'feedback' }
      ];
      
      // Get color based on process type and metrics
      const getProcessColor = (process) => {
        if (process.type === 'supplier') return 'bg-blue-100 border-blue-500';
        if (process.type === 'customer') return 'bg-green-100 border-green-500';
        if (process.type === 'inventory') return 'bg-yellow-100 border-yellow-500';
        
        // For process nodes, color based on OEE/utilization
        if (process.metrics && process.metrics.oeeUtilization) {
          if (process.metrics.oeeUtilization >= 90) return 'bg-green-100 border-green-500';
          if (process.metrics.oeeUtilization >= 80) return 'bg-blue-100 border-blue-500';
          if (process.metrics.oeeUtilization >= 70) return 'bg-yellow-100 border-yellow-500';
          return 'bg-red-100 border-red-500';
        }
        
        return 'bg-gray-100 border-gray-500';
      };

      // Check if a process should be highlighted
      const isProcessHighlighted = (processId) => {
        const matchProcess = processId.split('-')[1]; // Extract 'receiving', 'stocktake', etc.
        return highlightedProcess === matchProcess;
      };
      
      // Handle process click
      const handleProcessClick = (process) => {
        setSelectedProcess(process);
      };

      // Handle drill-down click
      const handleDrillDown = (process, e) => {
        e.stopPropagation(); // Prevent triggering the parent click handler
        
        if (process.hasDrillDown && process.drillDownUrl) {
          window.location.href = process.drillDownUrl;
        }
      };

      // Handle mouse enter for tooltip
      const handleMouseEnter = (process) => {
        setTooltip({
          show: process.hasDrillDown,
          text: 'Click to view detailed process flow',
          x: 0,
          y: 0
        });
      };
      
      // Handle mouse move for tooltip
      const handleMouseMove = (e) => {
        if (tooltip.show) {
          setTooltip({
            ...tooltip,
            x: e.clientX + 10,
            y: e.clientY + 10
          });
        }
      };
      
      // Handle mouse leave for tooltip
      const handleMouseLeave = () => {
        setTooltip({ show: false, text: '', x: 0, y: 0 });
      };

      // Create SVG paths for connections
      const renderConnections = () => {
        return connections.map((conn, index) => {
          const fromProcess = processes.find(p => p.id === conn.from);
          const toProcess = processes.find(p => p.id === conn.to);
          
          if (!fromProcess || !toProcess) return null;
          
          const startX = fromProcess.position.x;
          const startY = fromProcess.position.y;
          const endX = toProcess.position.x;
          const endY = toProcess.position.y;
          
          // Calculate if connection should be highlighted
          const isHighlighted = 
            isProcessHighlighted(conn.from) || 
            isProcessHighlighted(conn.to);
          
          // For feedback connection, create a curved path
          if (conn.type === 'feedback') {
            const controlX = (startX + endX) / 2;
            const controlY = Math.max(startY, endY) + 20;
            
            return (
              <path 
                key={`conn-${index}`}
                d={`M ${startX}% ${startY}% Q ${controlX}% ${controlY}% ${endX}% ${endY}%`}
                className={`connection-path ${isHighlighted ? 'highlighted' : ''}`}
                marker-end="url(#arrowhead)"
              />
            );
          }
          
          // For vertical connections from suppliers
          if (fromProcess.type === 'supplier') {
            return (
              <path 
                key={`conn-${index}`}
                d={`M ${startX}% ${startY}% L ${startX + 8}% ${startY}% L ${endX - 8}% ${endY}% L ${endX}% ${endY}%`}
                className={`connection-path ${isHighlighted ? 'highlighted' : ''}`}
                marker-end="url(#arrowhead)"
              />
            );
          }
          
          // Standard straight connection
          return (
            <path 
              key={`conn-${index}`}
              d={`M ${startX}% ${startY}% L ${endX}% ${endY}%`}
              className={`connection-path ${isHighlighted ? 'highlighted' : ''}`}
              marker-end="url(#arrowhead)"
            />
          );
        });
      };
      
      // Create the waste icons for a process
      const createWasteIcons = (process) => {
        if (!wasteData[process.id]) return null;
        
        return wasteData[process.id].wastes.map((waste, index) => {
          const wasteInfo = wasteIcons[waste.type];
          if (!wasteInfo) return null;
          
          // Position icons above the nodes (outside)
          const top = process.type === 'inventory' ? -40 : -30;
          // Calculate horizontal offset for multiple icons
          const offset = index * 28 - ((wasteData[process.id].wastes.length - 1) * 14);
          
          // Determine if counter-rotation is needed for the tooltip
          const tooltipClass = process.type === 'inventory' ? 'waste-tooltip tooltip-needs-unrotate' : 'waste-tooltip';

          return (
            <div 
              key={index}
              className={`waste-icon ${wasteInfo.color}`}
              style={{
                top: `${top}px`, 
                left: `calc(50% + ${offset}px)`,
                transform: 'translateX(-50%)'
              }}
            >
              <span>{wasteInfo.icon}</span>
              {/* Apply conditional class here */}
              <div className={tooltipClass}>
                <strong>{wasteInfo.name}</strong>
                {waste.data && <div>{waste.data}</div>}
              </div>
            </div>
          );
        });
      };
      
      // Render process details panel
      const renderProcessDetails = () => {
        if (!selectedProcess) return null;
        
        return (
          <div className="bg-white border rounded shadow-lg p-4 max-w-md absolute bottom-20 right-6 z-20">
            <div className="flex justify-between items-center mb-3">
              <h3 className="text-lg font-semibold">{selectedProcess.name}</h3>
              <button 
                onClick={() => setSelectedProcess(null)}
                className="text-gray-500 hover:text-gray-700"
              >
                X
              </button>
            </div>
            
            <div className="mb-3">
              <p className="text-sm text-gray-600">{selectedProcess.details}</p>
            </div>
            
            {selectedProcess.metrics && (
              <div className="mb-3">
                <h4 className="font-medium mb-1">Metrics:</h4>
                <div className="grid grid-cols-2 gap-2">
                  {Object.entries(selectedProcess.metrics).map(([key, value]) => (
                    <div key={key} className="text-sm">
                      <span className="font-medium capitalize">{key.replace(/([A-Z])/g, ' $1').trim()}:</span> {value}
                    </div>
                  ))}
                </div>
              </div>
            )}
            
            {wasteData[selectedProcess.id] && (
              <div>
                <h4 className="font-medium mb-1">Identified Wastes:</h4>
                <div className="space-y-2">
                  {wasteData[selectedProcess.id].wastes.map((waste, index) => {
                    const wasteInfo = wasteIcons[waste.type];
                    return (
                      <div key={index} className="flex items-center gap-2 text-sm">
                        <span className={`inline-block ${wasteInfo.color} rounded-full p-1`}>
                          {wasteInfo.icon}
                        </span>
                        <div>
                          <div className="font-medium">{wasteInfo.name}</div>
                          <div className="text-gray-600">{waste.data}</div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}

            {selectedProcess.hasDrillDown && (
              <div className="mt-4 pt-3 border-t border-gray-200">
                <button 
                  onClick={(e) => handleDrillDown(selectedProcess, e)}
                  className="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700"
                >
                  View Detailed Process Flow
                </button>
              </div>
            )}
          </div>
        );
      };
      
      // Render info modal
      const renderInfoModal = () => {
        if (!showInfoModal) return null;
        
        return (
          <div className="modal-overlay">
            <div className="modal-content">
              <div className="p-4 border-b flex justify-between items-center">
                <h2 className="text-xl font-semibold">
                  SimplePharma Value Stream Map
                </h2>
                <button 
                  onClick={() => setShowInfoModal(false)}
                  className="text-gray-500 hover:text-gray-700"
                >
                  X
                </button>
              </div>
              
              <div className="p-6 max-h-[70vh] overflow-y-auto">
                <div className="bg-blue-50 border border-blue-200 rounded p-4 mb-4">
                  <h3 className="font-semibold mb-2">About this Value Stream Map</h3>
                  <p className="text-sm">
                    This value stream map visualizes the flow of materials and information through SimplePharma's
                    operations, from suppliers to customers. It highlights key processes, wait times, metrics,
                    and waste categories to identify opportunities for improvement.
                  </p>
                </div>
                
                <h3 className="font-semibold mb-2">How to Use this Map</h3>
                <ul className="space-y-2 text-sm mb-4">
                  <li>Click on any process node to see detailed information</li>
                  <li>Use the view mode toggles to switch between Current, Improved, and Ideal states</li>
                  <li>Review the overall metrics to understand system performance</li>
                  <li>Hover over waste icons (🔄, ⏳, etc.) to see waste details</li>
                  <li>Use the "View Detailed Process Flow" button when available to see the micro-level process</li>
                </ul>
                
                <h3 className="font-semibold mb-2">Legend</h3>
                <div className="grid grid-cols-2 gap-3 mb-4">
                  <div className="flex items-center p-2 border rounded">
                    <div className="w-6 h-6 bg-blue-100 border-2 border-blue-500 rounded flex items-center justify-center mr-2">
                    </div>
                    <span className="text-sm">Supplier</span>
                  </div>
                  <div className="flex items-center p-2 border rounded">
                    <div className="w-6 h-6 bg-green-100 border-2 border-green-500 rounded flex items-center justify-center mr-2">
                    </div>
                    <span className="text-sm">Customer</span>
                  </div>
                  <div className="flex items-center p-2 border rounded">
                    <div className="w-6 h-6 bg-blue-100 border-2 border-blue-500 rounded flex items-center justify-center mr-2">
                    </div>
                    <span className="text-sm">Operation Process</span>
                  </div>
                  <div className="flex items-center p-2 border rounded">
                    <div className="w-6 h-6 bg-yellow-100 border-2 border-yellow-500 rounded transform rotate-45 mr-2">
                    </div>
                    <span className="text-sm">Inventory/WIP</span>
                  </div>
                  <div className="flex items-center p-2 border rounded">
                    <div className="w-6 h-6 border-2 border-yellow-500 relative mr-2">
                      <div className="absolute -top-2 -right-2 w-5 h-5 bg-yellow-300 rounded-full flex items-center justify-center text-xs font-bold">
                        ↓
                      </div>
                    </div>
                    <span className="text-sm">Process with Drill-Down</span>
                  </div>
                </div>
                
                <h3 className="font-semibold mb-2">Waste Categories</h3>
                <div className="grid grid-cols-2 gap-3 mb-4">
                  {Object.entries(wasteIcons).map(([type, info]) => (
                    <div key={type} className="flex items-center p-2 border rounded">
                      <div className={`w-6 h-6 ${info.color} rounded-full flex items-center justify-center mr-2`}>
                        {info.icon}
                      </div>
                      <span className="text-sm">{info.name}</span>
                    </div>
                  ))}
                </div>
                
                <h3 className="font-semibold mb-2">Value Stream States</h3>
                <div className="space-y-2 text-sm mb-4">
                  <div>
                    <span className="font-medium">Current State:</span> Shows the existing process with actual metrics
                    and highlights bottlenecks and inefficiencies.
                  </div>
                  <div>
                    <span className="font-medium">Improved State:</span> Shows the proposed short-term improvements
                    focusing on RFID implementation and layout optimization.
                  </div>
                  <div>
                    <span className="font-medium">Ideal State:</span> Shows the fully optimized future state with
                    complete automation and supplier integration.
                  </div>
                </div>
                
                <div className="text-center mt-6 text-sm text-gray-500">
                  Developed as part of Lean Six Sigma analysis for SimplePharma
                </div>
              </div>
              
              <div className="p-4 border-t">
                <button 
                  onClick={() => setShowInfoModal(false)}
                  className="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700"
                >
                  Close
                </button>
              </div>
            </div>
          </div>
        );
      };
      
      // Update metrics based on view mode
      React.useEffect(() => {
        if (viewMode === 'improved') {
          setMetrics({
            totalLeadTime: 59.9,
            valueAddedTime: 10.8,
            processCycleEfficiency: 18.0,
            accuracyRate: 92.5
          });
        } else if (viewMode === 'ideal') {
          setMetrics({
            totalLeadTime: 34.3,
            valueAddedTime: 9.9,
            processCycleEfficiency: 28.9,
            accuracyRate: 99.5
          });
        } else {
          setMetrics({
            totalLeadTime: 85.7,
            valueAddedTime: 12.4,
            processCycleEfficiency: 14.5,
            accuracyRate: 76.5
          });
        }
      }, [viewMode]);

      // Extract parameters from URL on component mount
      React.useEffect(() => {
        const queryParams = new URLSearchParams(window.location.search);
        const highlightParam = queryParams.get('highlight');
        
        if (highlightParam) {
          setHighlightedProcess(highlightParam);
          
          // Find the process and auto-select it
          const process = processes.find(p => p.id === `process-${highlightParam}`);
          if (process) {
            setSelectedProcess(process);
          }
        }

        // Listen for postMessage events
        window.addEventListener('message', (event) => {
          if (event.data && event.data.action === 'highlightProcess') {
            setHighlightedProcess(event.data.process);
            
            // Find the process and auto-select it
            const process = processes.find(p => p.id === `process-${event.data.process}`);
            if (process) {
              setSelectedProcess(process);
            }
          }
        }, false);

        return () => {
          window.removeEventListener('message', () => {});
        };
      }, []);
      
      return (
        <div className="flex flex-col h-screen bg-gray-100">
          {/* Header */}
          <header className="bg-blue-700 text-white p-4">
            <div className="flex items-center justify-between">
              <h1 className="text-xl font-bold">SimplePharma Value Stream Map</h1>
              <div className="flex items-center space-x-4">
                <button 
                  onClick={() => setShowInfoModal(true)}
                  className="flex items-center gap-1 bg-blue-600 hover:bg-blue-500 px-3 py-1 rounded"
                >
                  <span>Info</span>
                </button>
              </div>
            </div>
          </header>
          
          {/* Control Bar */}
          <div className="bg-white shadow p-3 flex flex-wrap justify-between items-center gap-2">
            {/* View Mode Selector */}
            <div className="flex rounded overflow-hidden border">
              {['current', 'improved', 'ideal'].map(mode => (
                <button
                  key={mode}
                  class